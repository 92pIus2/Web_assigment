<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Account</title>
    <!-- ... (include CSS and other necessary scripts) ... -->
</head>

<body>
<h1>User Account Page</h1>
<div>
    <!-- Displayed user information will be updated dynamically -->
    <h2>User Information</h2>
    <p>Username: <span id="usernamePlaceholder"></span></p>
    <p>Email: <span id="emailPlaceholder"></span></p>
</div>
<div>
    <!-- Placeholder content for order history -->
    <h2>Order History</h2>
    <ul>
        <li>Order #12345 - Total: $50.00</li>
        <li>Order #67890 - Total: $30.00</li>
        <!-- Add more order details here -->
    </ul>
</div>
<div>
    <!-- Update account details form -->
    <h2>Update Account Details</h2>
    <form id="updateForm">
        <label for="newUsername">Username:</label>
        <input type="text" id="newUsername" name="newUsername" required>

        <label for="newPassword">Password:</label>
        <input type="password" id="newPassword" name="newPassword" required>

        <button type="submit">Update</button>
    </form>
</div>
<script>
    document.getElementById('usernamePlaceholder').textContent = '{{username}}'; // Set initial username value
    getUserEmail();

    // Update account details form submission
    document.getElementById('updateForm').addEventListener('submit', function (event) {
        event.preventDefault();
        const newUsername = document.getElementById('newUsername').value;
        const newPassword = document.getElementById('newPassword').value;

        // Assuming you have a variable "username" containing the currently logged-in username
        const username = '{{username}}'; // Replace this with the currently logged-in username

        // Call the function to update user data
        updateUserData(username, newUsername, newPassword);
    });

    function getUserEmail() {
        fetch('/get_user_email')
                .then(response => response.json())
                .then(data => {
                    if (!data.email) {
                        // If email is empty, set a default placeholder
                        document.getElementById('emailPlaceholder').textContent = 'Email not available';
                    } else {
                        // If email is available, update the displayed email on the page
                        document.getElementById('emailPlaceholder').textContent = data.email;
                    }
                })
                .catch(error => {
                    console.error('Error fetching user email:', error);
                    alert('An error occurred while fetching user email.');
                });
    }

    // Function to update user data
    function updateUserData(username, newUsername, newPassword) {
        // Send a request to the server to update user data
        fetch(`/update_user_by_username`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                username,
                newUsername,
                newPassword
            }),
        })
        document.getElementById('usernamePlaceholder').textContent = newUsername;
    }
</script>

</body>

</html>
